/* Copyright (c) Tan Nhu, http://lnkd.in/tnhu */
(function(q,w,x,y,B,C,D,z,r){function A(a){return a&&typeof a===w&&!(typeof a.length===x&&!a.propertyIsEnumerable(y))&&a||null}function s(a){return a&&typeof a===w&&typeof a.length===x&&!a.propertyIsEnumerable(y)&&a||null}function t(a){return a&&"function"===typeof a&&a||null}function u(a){return t(a)&&a.prototype&&a===a.prototype.constructor&&a||null}function v(a,c,d){if(s(c))for(var g=c.length;0<=--g;)v(a,c[g],d);else{d=d||{constructor:1,$super:1,prototype:1,$superp:1};var g=u(a),p=u(c),b=a.prototype,
f,h;if(A(c))for(f in c){h=f;var k=c[f],e=a,l=g,m=b;d&&d.hasOwnProperty(h)||(e[h]=k,l&&(m[h]=k))}if(p)for(f in h=c.prototype,h){var k=f,e=h[f],l=a,m=g,n=b;d&&d.hasOwnProperty(k)||(l[k]=e,m&&(n[k]=e))}g&&p&&v(b,c.prototype,d)}}function n(a,c){c||(a=(c=a,0));var d,g,p,b,f,h,k=0,e,l={constructor:1,$singleton:1,$statics:1,prototype:1,$super:1,$superp:1,main:1,toString:0};f=n.overload;var m=n.plugins;c=("function"===typeof c?c():c)||{};d=c.hasOwnProperty("constructor")?c.constructor:0;g=c.$singleton;p=
c.$statics;for(b in m)l[b]=1;d=g?{}:d?f?f("constructor",d):d:function(){};f=g?d:d.prototype;for(h=(a=!a||s(a)?a:[a])&&a.length;k<h;){e=a[k++];for(b in e)l[b]||(f[b]=e[b],g||(d[b]=e[b]));for(b in e.prototype)l[b]||(f[b]=e.prototype[b])}for(b in c)l[b]||(f[b]=c[b]);for(b in p)d[b]=f[b]=p[b];g||(e=a&&a[0]||a,d.$super=e,d.$superp=e&&e.prototype?e.prototype:e);for(b in m)m[b](d,a,c);t(c.main)&&c.main.call(d,d);return d}n.plugins={};r={version:C,Class:n,extend:v,mapOrNil:A,arrayOrNil:s,functionOrNil:t,
stringOrNil:function(a){return"[object String]"===B.apply(a)&&a||null},classOrNil:u};"undefined"!==typeof module&&module.exports?module.exports=r:(z=q.Class,q.Class=n,q.jsface=r,r.noConflict=function(){q.Class=z})})(this,"object","number","length",Object.prototype.toString,"2.1.2");

(function(a){a=a.jsface||require("./jsface");var p=a.functionOrNil,k=[],l=0;a.Class.plugins.$ready=function q(c,b,a,r){for(var f=a.$ready,d=b?b.length:0,m=d,n=d&&b[0].$super,g,e,h;d--;)for(e=0;e<l&&(h=k[e],g=b[d],g===h[0]&&(h[1].call(g,c,b,a),m--),m);e++);n&&q(c,[n],a,!0);!r&&p(f)&&(f.call(c,c,b,a),k.push([c,f]),l++)}})(this);

Class(function(){function J(f){for(var b={},e=f&&f.split("|"),a=e&&e.length||0,c,d,h,g;a--;)if(c=e[a].split(":"),d=c.length,0<d&&3>d)for(1===c.length&&c.unshift(r),d=c[0].split(","),h=d.length;h--;)g=d[h],b[g]=c[1],B[g]||(b.nondelegable=!0);else console.log(t,"unrecognized action",f);return b}function x(f,b,e){b=b?b:n(f.target);e=e?e:f.type;var a=q.instanceRefs,c,d;if(d=b.attr(C)){d=d.split("/");c=d[0];d=d[1];a=a[c];if(!a)return l(f,e,!1,c);c=a.instance;e=a[d][e];d=K(c[e]);if(e){if(d)return d.call(c,
f,b);console.log(t,e,"not implemented")}}}function l(f,b,e,a){var c=b?n(f.target):n(this);b=b||f.type;var d=q.instanceRefs,h,g,k,m,s;g=c.attr(C);if(!a&&g)return x(f,c,b);c=c.closest(L);if(c.length&&(g=c.attr(v),!g||a))if(k=c.attr(D),m=k.split("/")[0],g=q[m]){s=g.prototype.type;b=(b=c.attr(M))&&b.replace(/'/g,'"');try{b=b&&N(b)}catch(r){console.log(t,"config not well-formed",b),Kanji.notify("com:config-not-wellformed",b)}switch(s){case "shared":a:{var p=q.instanceRefs;for(h in p)if(a=p[h],a=a.instance,
a instanceof g){a={instance:a,instanceId:h};break a}a=new g;h=E++;a={instance:a,instanceId:h};p[h]=a}h=a.instance;g=a.instanceId;break;default:if(h=new g,g=a||E++,a={instance:h,instanceId:g},d[g]=a,d=h,k=k.substring(m.length+1)){d.namespace=k;s=d.listeners;m={};for(p in s)m[p+"/"+k]=m[p]=s[p];d.listeners=m}}p=a;d=p.instanceId;k=p.instance.actions;var l,u,w;for(l in k)if(w="self"===l?c:c.find(l),w.length){s=O++;w.attr("data-act",d+"/"+s);m={};for(u in k[l])if(m[u]=k[l][u],!B[u])w.on(u,x);p[s]=m}c.attr(v,
g);h.init(c,b);h.render(c);if(!e)return x(f);delete a.instanceId}else console.log(t,"Component not found",m),Kanji.notify("com:not-found",m,c)}function F(){var f=q.instanceRefs,b=+new Date,e,a;for(e in f)if("0"!==e&&(a=n(["[",v,"=",e,"]"].join(y)),a.length||delete f[e],+new Date-b>P))break;G(F,H)}var r="click",D="data-com",M="data-cfg",v="data-instance",C="data-act",L="[data-com]",B={mousedown:1,touchstart:1,keydown:1},y="",t="[ERROR] Kanji:",H=1500,P=250,K=jsface.functionOrNil,Q=jsface.mapOrNil,
n=jQuery,G=setTimeout,R=[].slice,N="object"===typeof JSON&&JSON.parse||n.parseJSON,I=0,z=[],E=1,O=1,q={instanceRefs:{}},A;return{$statics:{notify:function(){var f=R.call(arguments),b=f.shift(),e=q.instanceRefs,a,c,d,b="shared"===this.type?b:this.namespace?[b,"/",this.namespace].join(y):b;for(a in e)if(c=e[a].instance||e[a])d=c.listeners,d[b]&&d[b].apply(c,f);Kanji.debug&&console.log("Kanji:",b)}},init:function(f,b){},render:function(f){},listeners:{},$ready:function(f,b,e){var a,c,d,h,g;if(this!==
f)if(a=e.id){if(!q[a]){q[a]=f;a=['[data-com="',a,'"],[data-com^="',a,'/"]'].join(y);d=f.$superp;b=f.$super;for(h=f.prototype;d;){d=d.listeners;for(c in d)e.listeners[c]||(e.listeners[c]=d[c]);d=b.$superp;b=b.$super}if(e=Q(e.actions)){for(g in e)e[g]=J(e[g]),e[g].nondelegable&&(f.hasNondelegableEvents=!0,delete e[g].nondelegable);h.actions=e}I?n(a).each(function(){var a=n(this);(!1===h.lazy||f.hasNondelegableEvents)&&l({target:a[0]},r,!0)}):z.push(a)}}else console.log(t,"id not found on",e)},main:function(f){Kanji=
f;q={instanceRefs:{0:{listeners:{"com:init":function(b){l({target:b[0]},r,!0,b.attr(v))}}}}};n.fn.ready(function(){var b=n(document),e=z.length,a=0,c,d,f,g,k;for(I=1;a<e;)if(c=n(z[a++]),d=c.length,f=0,d)for(;f<d;)g=n(c[f++]),k=g.attr(D).split("/")[0],k=q[k],(!1===k.prototype.lazy||k.hasNondelegableEvents)&&l({target:g[0]},r,!0);b.on("touchend",function(a){A=!0;return l(a,r)}).on(r,function(a){if(!A)return l(a,r);A=!1});b.on("mousedown touchstart keydown",function(a){return l(a,a.type)});G(F,H)})}}});